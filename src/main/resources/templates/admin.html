<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://kit.fontawesome.com/9011056154.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="/css/style3.css">
    <script language="javascript" src></script>
    <link rel="icon" type="image/x-icon" href="/assets/icon.ico"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="http://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
    <title>Movie System | Admin</title>
    <style>
        .content th,
        .content td{
            color: black;
            padding: 3px;
        }

        .pagination{
            height: auto;
            margin: 10px 0;
            display: flex;
            justify-content: center;
        }
        .pagination a{
            padding: 5px 8px;
            margin: 0 5px;
            border: 1px solid whitesmoke;
        }
    </style>
</head>

<body>
<div class="container-fluid">
    <div class="row">
        <div class="col-md-2">
            <div class="slide-bar" style="width: initial; position: unset;">
                <div class="slide-bar-start">
                    <a th:href="@{/admin}">Movies</a>
                    <a th:href="@{/admin/episode}">Episodes</a>
                    <a href="actor">Actors</a>
                    <a href="user">Users</a>
                </div>
                <div class="slide-bar-end">
                    <a th:href="@{/}">Trang chủ</a>
                </div>
            </div>
        </div>
        <div id="movie-admin" class="col-md-10" th:if="${#strings.equals(page, 'movie')}">
            <div class="title" style="height: 10vh">
                <h1>Movie</h1>
            </div>
            <div id="movie-element">
                <div class="content" style="margin-top: 7px">
                    <div class="search" style="display: inline-flex">
                        <form th:action="@{/admin/filter}" style="width: 90%;">
                            <div class="list-search">
                                <span>Tìm kiếm:</span>
                                <label for="movie-name">
                                    <input type="text" id="movie-name" placeholder="Tên phim"
                                           class="form-control" name="movie_name">
                                </label>
                            </div>

                            <div class="list-search">
                                <label for="category">Thể loại</label>
                                <select class="form-control" id="category" name="genre">
                                    <option value="Tất cả">Tất cả</option>
                                    <option th:each="genre : ${genres}" th:value="${genre}" th:text="${genre}"></option>
                                </select>
                            </div>
                            <div class="list-search">
                                <label for="year">Năm phát hành</label>
                                <select id="year" name="year" class="form-control">
                                    <option value="Tất cả">Tất cả</option>
                                    <option th:each="year:${years}" th:value="${year}" th:text="${year}"></option>
                                </select>
                            </div>
                            <button type="submit" id="btn-movie-filter" class="btn btn-dark btn-filter-movie">
                                <span>Áp dụng</span>
                            </button>
                        </form>
                        <button class="btn btn-success" onclick="showAdd()"
                                style="display:flex; float:right; margin: 10px; align-items: center;">
                            <i class="fa-solid fa-plus"></i>
                        </button>
                    </div>
                </div>
                <div class="content" style="margin-top: 7px">
                    <table border="1" style="width: 100%;">
                        <colgroup>
                            <col style="width: 5%">
                            <col style="width: 40%">
                            <col style="width: 10%">
                            <col style="width: 15%">
                            <col style="width: 10%">
                            <col style="width: 10%">
                            <col style="width: 10%">
                        </colgroup>
                        <tr>
                            <th>ID</th>
                            <th>Tên phim</th>
                            <th>Số tập</th>
                            <th>Quốc gia</th>
                            <th>Điểm</th>
                            <th>Lượt xem</th>
                            <th></th>
                        </tr>
                        <tr th:each="movie : ${movies}">
                            <td th:text="${movie.movieId}"></td>
                            <td th:text="${movie.title}"></td>
                            <td th:text="${movie.totalEpisode}"></td>
                            <td th:text="${movie.nation}"></td>
                            <td th:text="${movie.rating}"></td>
                            <td th:text="${movie.totalView}"></td>
                            <td>
                                <a type="button" class="btn btn-success" th:href="@{/admin/edit(id=${movie.movieId})}">
                                    <i class="fa-solid fa-pen-nib"></i>
                                </a>
                                <a type="button" class="btn btn-danger" th:href="@{/admin/delete(id=${movie.movieId})}">
                                    <i class="fa-solid fa-trash-can"></i>
                                </a>
                            </td>
                        </tr>
                    </table>
                    <div class="pagination" th:if="${moviePage.totalPages > 1 && #strings.equals(dividerPage, '')}"
                         style="display:flex; justify-content:center;">
                        <a th:if="${moviePage.hasPrevious()}"
                           th:href="@{/admin(page=*{0}, size=${moviePage.size})}">
                            <span aria-hidden="true">&laquo;</span>
                        </a>
                        <a th:each="i : ${#numbers.sequence(0, moviePage.totalPages - 1)}"
                           th:class="${moviePage.number == i ? 'paitem active' : 'paitem'}"
                           th:href="@{/admin(page=*{i}, size=${moviePage.size})}"
                           th:text="${i + 1}"></a>
                        <a th:if="${moviePage.hasNext()}"
                           th:href="@{/admin(page=*{moviePage.totalPages - 1}, size=${moviePage.size})}"
                           aria-label="Last">
                            <span aria-hidden="true">&raquo;</span>
                        </a>
                    </div>
                    <div id="filter" class="pagination" th:if="${moviePage.totalPages > 1 && #strings.equals(dividerPage, 'filter')}"
                         style="display:flex; justify-content:center;">
                        <a th:if="${moviePage.hasPrevious()}"
                           th:href="@{/admin/filter(movie_name=${movieNameFilter}, genre=${genreFilter}, year=${yearFilter}, page=*{0}, size=${moviePage.size})}">
                            <span aria-hidden="true">&laquo;</span>
                        </a>
                        <a th:each="i : ${#numbers.sequence(0, moviePage.totalPages - 1)}"
                           th:class="${moviePage.number == i ? 'paitem active' : 'paitem'}"
                           th:href="@{/admin/filter(movie_name=${movieNameFilter}, genre=${genreFilter}, year=${yearFilter}, page=*{i}, size=${moviePage.size})}"
                           th:text="${i + 1}"></a>
                        <a th:if="${moviePage.hasNext()}"
                           th:href="@{/admin/filter(movie_name=${movieNameFilter}, genre=${genreFilter}, year=${yearFilter}, page=*{moviePage.totalPages - 1}, size=${moviePage.size})}"
                           aria-label="Last">
                            <span aria-hidden="true">&raquo;</span>
                        </a>
                    </div>
                </div>
            </div>
            <div id="movie-form" style="display: none;">
                <div class="content">
                    <form th:action="@{/admin/handle}" method="get" style="font-size: 12px">
                        <input type="hidden" name="id" th:value="${movieEdit != null ? movieEdit.movieId : '0'}">
                        <label for="title">Tên phim:</label>
                        <input class="form-control" type="text" id="title" name="title" required
                               th:value="${movieEdit != null ? movieEdit.title : ''}">

                        <label for="description">Mô tả:</label>
                        <textarea class="form-control" type="text" id="description" name="description" required style="height: 100px;"
                                  th:text="${movieEdit != null ? movieEdit.description : ''}"></textarea>

                        <div style="display: flex;">
                            <label for="genre" style="margin-right: 30px;">Thể loại:
                                <input class="form-control" type="text" id="genre" name="genre" required
                                       th:value="${movieEdit != null ? movieEdit.genre : ''}">
                            </label>


                            <label for="episode" style="margin-right: 30px;">Số tập:
                                <input class="form-control" type="number" id="episode" name="episode" required
                                       th:value="${movieEdit != null ? movieEdit.totalEpisode : ''}">
                            </label>

                            <label for="Director">Đạo diễn:
                                <input class="form-control" type="text" id="director" name="director" required
                                       th:value="${movieEdit != null ? movieEdit.director : ''}">
                            </label>
                        </div>

                        <label for="poster">Poster:</label>
                        <textarea class="form-control" type="text" id="poster" name="poster" required
                                  th:text="${movieEdit != null ? movieEdit.poster : ''}"></textarea>

                        <label for="trailer">Trailer:</label>
                        <textarea class="form-control" type="text" id="trailer" name="trailer" required
                                  th:text="${movieEdit != null ? movieEdit.trailer : ''}"></textarea>
                        <div style="display: flex;">
                            <label for="nation" style="margin-right: 30px;">Nation:
                                <input class="form-control" type="text" id="nation" name="nation" required
                                       th:value="${movieEdit != null ? movieEdit.nation : ''}">
                            </label>

                            <label for="date">Release Date:
                                <input class="form-control" type="text" id="date" name="date" required
                                       th:value="${movieEdit != null ? movieEdit.releaseDate : ''}">
                            </label>
                        </div>

                        <div style="display: flex;">
                            <button style="margin-top: 20px; width: 200px;" class="btn btn-dark" type="submit">Save</button>
                        </div>
                    </form>
                </div>
            </div>

            <script th:inline="javascript">
                /*<![CDATA[*/
                const movieElement = document.getElementById('movie-element');
                const movieForm = document.getElementById('movie-form');

                function showAdd(){
                    movieElement.style.display = 'none';
                    movieForm.style.display = '';
                }

                const showMovieForm = /*[[${showMovieForm}]]*/ false;
                if(showMovieForm){
                    showAdd();
                }
                /*]]>*/
            </script>
        </div>
        <div id="episode-admin" class="col-md-10" th:if="${#strings.equals(page, 'episode')}">
            <div class="title" style="height: 10vh">
                <h1>Episode</h1>
            </div>
            <div id="episode-element">
                <div class="content" style="margin-top: 7px">
                    <div class="search" style="display: inline-flex">
                        <form th:action="@{/admin/episode/filter}" style="width: 90%;">
                            <div class="list-search">
                                <label for="movie-episode">Phim</label>
                                <select class="form-control" id="movie-episode" name="movie">
                                    <option value="Tất cả">Tất cả</option>
                                    <option th:each="movie : ${movies}" th:value="${movie.title}" th:text="${movie.title}"></option>
                                </select>
                            </div>
                            <button type="submit" id="btn-episode-filter" class="btn btn-dark btn-filter-movie">
                                <span>Áp dụng</span>
                            </button>
                        </form>
                        <button class="btn btn-success" onclick="showAddEpisode()"
                                style="display:flex; float:right; margin: 10px; align-items: center;">
                            <i class="fa-solid fa-plus"></i>
                        </button>
                    </div>
                </div>
                <div class="content" style="margin-top: 7px">
                    <table border="1" style="width: 100%;">
                        <colgroup>
                            <col style="width: 5%">
                            <col style="width: 50%">
                            <col style="width: 15%">
                            <col style="width: 10%">
                            <col style="width: 10%">
                            <col style="width: 10%">
                        </colgroup>
                        <tr>
                            <th>ID</th>
                            <th>Tên phim</th>
                            <th>Tập phim</th>
                            <th>Thời lượng (phút)</th>
                            <th>Lượt xem</th>
                            <th></th>
                        </tr>
                        <tr th:each="episode : ${episodes}">
                            <td th:text="${episode.episodeId}"></td>
                            <td th:text="${episode.movie.title}"></td>
                            <td th:text="${episode.episodeName}"></td>
                            <td th:text="${episode.duration}"></td>
                            <td th:text="${episode.view}"></td>
                            <td>
                                <a type="button" class="btn btn-success" th:href="@{/admin/episode/edit(id=${episode.episodeId})}">
                                    <i class="fa-solid fa-pen-nib"></i>
                                </a>
                                <button class="btn btn-danger">
                                    <i class="fa-solid fa-trash-can"></i>
                                </button>
                            </td>
                        </tr>
                    </table>
                    <div class="pagination" th:if="${episodePage.totalPages > 1 && #strings.equals(dividerPage, '')}"
                         style="display:flex; justify-content:center;">
                        <a th:if="${episodePage.hasPrevious()}"
                           th:href="@{/admin/episode(page=*{0}, size=${episodePage.size})}">
                            <span aria-hidden="true">&laquo;</span>
                        </a>
                        <a th:each="i : ${#numbers.sequence(0, episodePage.totalPages - 1)}"
                           th:class="${episodePage.number == i ? 'paitem active' : 'paitem'}"
                           th:href="@{/admin/episode(page=*{i}, size=${episodePage.size})}"
                           th:text="${i + 1}"></a>
                        <a th:if="${episodePage.hasNext()}"
                           th:href="@{/admin/episode(page=*{episodePage.totalPages - 1}, size=${episodePage.size})}"
                           aria-label="Last">
                            <span aria-hidden="true">&raquo;</span>
                        </a>
                    </div>
                    <div id="filter-episode" class="pagination" th:if="${episodePage.totalPages > 1 && #strings.equals(dividerPage, 'filter')}"
                         style="display:flex; justify-content:center;">
                        <a th:if="${episodePage.hasPrevious()}"
                           th:href="@{/admin/episode/filter(movie=${movieFilter}, page=*{0}, size=${episodePage.size})}">
                            <span aria-hidden="true">&laquo;</span>
                        </a>
                        <a th:each="i : ${#numbers.sequence(0, episodePage.totalPages - 1)}"
                           th:class="${episodePage.number == i ? 'paitem active' : 'paitem'}"
                           th:href="@{/admin/episode/filter(movie=${movieFilter}, page=*{i}, size=${episodePage.size})}"
                           th:text="${i + 1}"></a>
                        <a th:if="${episodePage.hasNext()}"
                           th:href="@{/admin/episode/filter(movie=${movieFilter}, page=*{episodePage.totalPages - 1}, size=${episodePage.size})}"
                           aria-label="Last">
                            <span aria-hidden="true">&raquo;</span>
                        </a>
                    </div>
                </div>
            </div>
            <div id="episode-form" style="display: none;">
                <div class="content">
                    <form th:action="@{/admin/episode/handle}" method="get" style="font-size: 12px">
                        <input type="hidden" name="id" th:value="${episodeEdit != null ? episodeEdit.episodeId : '0'}">
                        <label for="episodeName">Tên tập phim:</label>
                        <input class="form-control" type="text" id="episodeName" name="episodeName" required
                               th:value="${episodeEdit != null ? episodeEdit.episodeName: ''}">

                        <label for="episodeFilm">Đường dẫn:</label>
                        <input class="form-control" type="text" id="episodeFilm" name="episodeFilm" required style="height: 100px;"
                                  th:value="${episodeEdit != null ? episodeEdit.episodeFilm : ''}">
                        <div style="display: flex;">
                            <label for="duration" style="margin-right: 30px;">Thời lượng:
                                <input class="form-control" type="number" id="duration" name="duration" required
                                       th:value="${episodeEdit != null ? episodeEdit.duration : ''}">
                            </label>


                            <div class="list-search">
                                <label for="movie-episode-dropdown">Phim</label>
                                <select class="form-control" id="movie-episode-dropdown" name="movie">
                                    <option value="Tất cả">Tất cả</option>
                                    <option th:each="movie : ${movies}"
                                            th:value="${movie.title}"
                                            th:text="${movie.title}"
                                            th:selected="${episodeEdit != null && episodeEdit.movie.title == movie.title}"></option>
                                </select>
                            </div>
                        </div>

                        <div style="display: flex;">
                            <button style="margin-top: 20px; width: 200px;" class="btn btn-dark" type="submit">Save</button>
                        </div>
                    </form>
                </div>
            </div>

            <script th:inline="javascript">
                /*<![CDATA[*/
                const episodeElement = document.getElementById('episode-element');
                const episodeForm = document.getElementById('episode-form');

                function showAddEpisode(){
                    episodeElement.style.display = 'none';
                    episodeForm.style.display = '';
                }

                const showEpisodeForm = /*[[${showEpisodeForm}]]*/ false;
                if(showEpisodeForm){
                    showAddEpisode();
                }
                /*]]>*/
            </script>
        </div>
    </div>
</div>
</body>

</html>